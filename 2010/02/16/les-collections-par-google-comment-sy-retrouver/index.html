<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.69.0" />

    
    
    

<title>Les collections par Google, comment s&#39;y retrouver? • The Coffee Workshop</title>













<meta property="og:updated_time" content="2010-02-16T15:51:49Z">



<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@BriceDutheil">
<meta name="twitter:title" content="Les collections par Google, comment s&amp;rsquo;y retrouver?">

<meta name="twitter:description" content="Java mostly, and general tech">
<meta name="twitter:creator" content="@BriceDutheil">
    
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/gruvbox-dark.min.css" media="(prefers-color-scheme: dark)">




<link rel="stylesheet" href="/scss/hyde-hyde.bed40372c96fe98a018d27e69bd7726c8d0a3b3f4c54486bff47216cf7553ce2.css" integrity="sha256-vtQDcslv6YoBjSfmm9dybI0KOz9MVEhr/0chbPdVPOI=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    
    <link rel="shortcut icon" sizes="192x192" href="/android-192-favicon.png">

    
    <link rel="shortcut icon" href="/android-192-favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/v4-shims.min.css" integrity="sha256-wN7QJaqAwQ03kgUhyN4EU2phRdDkLrQYbFe0EvpQ60U=" crossorigin="anonymous" />

    
    


    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://blog.arkey.fr">The Coffee Workshop</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/f31c7fbcbb0766d0632d96fd7e74b649?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Java mostly, and general tech 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">The Coffee Workshop</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/"><span class='fa-icon'><i class='fas fa-home'></i></span><code>cd <em>~</em></code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/"><span class='fa-icon'><i class='fas fa-stream'></i></span><code>ls <em>posts/*</em></code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/series/"><span class='fa-icon'><i class='fas fa-list-alt'></i></span><code>grep -o <em>series</em> posts/* | sort -u</code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/"><span class='fa-icon'><i class='fas fa-tags'></i></span><code>grep -o <em>tags</em> posts/* | sort -u</code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/cool-stuff/"><span class='fa-icon'><i class='fas fa-thumbtack'></i></span><code>cd <em>cool-stuff</em></code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/whoami/"><span class='fa-icon'><i class='fas fa-id-card'></i></span><code>whoami</code>
						<span></span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/@BriceDutheil" rel="me"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bird" class="svg-inline--fa fa-bird fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a>
	
	
	
	<a href="https://github.com/bric3" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://speakerdeck.com/bric3" rel="me"><i class="fab fa-speaker-deck" aria-hidden="true"></i></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/dutheilbrice" rel="me"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="pro-network" class="svg-inline--fa fa-pro-network fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a>
	
	
	<a href="https://stackoverflow.com/users/48136/brice" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2010 - 2020 Brice Dutheil
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Les collections par Google, comment s&#39;y retrouver?</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> 2010-02-16
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/code">code</a>
           
      
          <a class="badge badge-tag" href="/tags/google-collections">google-collections</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Depuis quelques jours déjà le framework de collection par google est sorti en version 1.0. Ce framework a vu le jour chez Google donc, et s’impose finalement comme le prochain framework pour travailler avec les collections. En effet les classes utilitaires du JDK sont plutôt limitées et les classes commons-collections de Apache ne sont pas <em>générifiés</em>.</p>
<p>Les classes fournies par Google, ont été tunées pour être performante en rapidité et en utilisation mémoire. Si possible ce sont les collections standard du JDK, les collections du JDK sont mutables. Éventuellement l&rsquo;utilisation des classes standard du JDK pourrait permettre à la JVM de faire les optimisation sur ces objets qu&rsquo;il connait. Également aussi l&rsquo;API orientée builder – un peu comme Joda-Time – facilite l&rsquo;utilisation de google-collections.</p>
<p>Pour commencer, vous pouvez jeter un œil aux classes suivantes :</p>
<pre><code class="language-java">com.google.common.collect.Collections2
com.google.common.collect.Lists
com.google.common.collect.Maps
com.google.common.collect.Sets
com.google.common.collect.ObjectArrays
com.google.common.collect.Multisets
com.google.common.collect.Multimaps
com.google.common.collect.Iterators
com.google.common.collect.Iterables
</code></pre>
<p>Ces classes utilitaires permettent déjà d’instancier les collections avec quelques commodités, par exemple dans le code ci-dessous les classes retournées sont les <strong>classes mutables du JDK</strong> :</p>
<pre><code class="language-java">LinkedHashSet&lt;String&gt; linkedHashSet = Sets.newLinkedHashSet();
ArrayList&lt;AGenericObject &lt;Class&lt;Observer&gt;&gt;&gt; arrayList = Lists.newArrayList();
Lists.newArrayList(&quot;bob&quot;, &quot;marie&quot;, &quot;barack&quot;, &quot;bruce&quot;);
</code></pre>
<p>à la place de :</p>
<pre><code class="language-java">List&lt;AGenericObject&lt;Class&lt;Observer&gt;&gt;&gt; list = new ArrayList&lt;AGenericObject&lt;Class&lt;Observer&gt;&gt;&gt;();
</code></pre>
<p>Voilà rapidement pour les utilitaires des collections fournies par le JDK, mais Google fournit également des <strong>implémentations immutables</strong> des collections :</p>
<pre><code class="language-java">ImmutableSet&lt;integer&gt; immutableSet = ImmutableSet.of(1, 2, 3, 4, 5);
ImmutableList&lt;string&gt; immutableList = ImmutableList.of(&quot;a,b,c,d,e,f,g&quot;.split(&quot;,&quot;));
</code></pre>
<p>Pour les maps, il y a aussi une API plutôt expressive et facilement utilisable. Par exemple pour créer facilement une multimap:</p>
<pre><code class="language-java">Multimap&lt;color , Fruit&gt; colorIndex = HashMultimap.create();
for (Fruit fruit : fruits) {
    colorIndex.put(fruit.getColor(), fruit);
}
Collection&lt;Fruit&gt; redFruits = colorIndex.get(Color.RED);
</code></pre>
<p>Si on veut jouer avec des map bi-directionnelles.</p>
<pre><code class="language-java">ImmutableBiMap&lt;Integer , String&gt; biMap = ImmutableBiMap.of(0, &quot;Zero&quot;, 1, &quot;One&quot;, 2, &quot;Two&quot;, 3, &quot;Three&quot;);
biMap.inverse().get(&quot;Zero&quot;); // =&gt; 0
</code></pre>
<p>L’outil MapMaker pour créer des maps customisées :</p>
<pre><code class="language-java">Map&lt;Params , Result&gt; resultCache = new MapMaker().expiration(5 * 60,TimeUnit.SECONDS)
    .makeComputingMap(new Function&lt;Params , Result&gt;() {
        public Result apply(Params param) {
            return computeHeavyAlgorythm();
        }
    }).makeMap();
</code></pre>
<p>Il est aussi possible de ne pas utiliser l’expiration mais de choisir plutôt des WeakReference ou des SoftReference pour les clés et/ou les valeurs.</p>
<p>Comment utiliser les Multiset. A noter, le Multiset ci-dessous est mutable! Pur un MultiSet immutable il faut le créer avec ImmutableMultiset.</p>
<pre><code class="language-java">Multiset&lt;String&gt; histogram = HashMultiset.create();
histogram.add(&quot;Hello&quot;);
histogram.add(&quot;World&quot;, 3);
histogram.add(&quot;Hello&quot;);
histogram.add(&quot;!&quot;);

int count;
count = histogram.count(&quot;Hello&quot;);    // 2
count = histogram.count(&quot;World&quot;);    // 3
count = histogram.count(&quot;Brice&quot;);    // 0
</code></pre>
<p>Et pour les itérateurs :</p>
<pre><code class="language-java">UnmodifiableIterator&lt;Object&gt; tokenizerIt = Iterators.forEnumeration(new StringTokenizer(&quot;a|b|c|d|e&quot;, &quot;|&quot;)); // Eh oui ! StringTokenizer implémente Enumeration&lt;Object&gt;

UnmodifiableIterator&lt;String&gt; splitIt = Iterators.forArray(&quot;e|ed|f|g|h|i&quot;.split(&quot;|&quot;));

Iterator&lt;object&gt; concatenatedIt = Iterators.concat(tokenizerIt, splitIt);

Iterators.frequency(concatenatedIt, &quot;e&quot;); // 2
concatenatedIt.hasNext(); // false
</code></pre>
<p>Ok maintenant que nous avons vu comment créer des collections, on peut regarder comment vraiment jouer avec. Ordonner une collection par exemple; il faut utiliser la classe Ordering (étends l’interface Comparator de java)</p>
<pre><code class="language-java">Function&lt;Fruit, Color&gt; getColorFunction = new Function() {
    public Color apply(Fruit from) {
        return from.getColor();
    }
};

Function&lt;Fruit , String&gt; getNameFunction = new Function() {
    public String apply(Fruit from) {
        return from.getName();
    }
};

Ordering&lt;Fruit&gt; colorOrdering = Ordering.natural().onResultOf(getColorFunction);
Ordering&lt;Fruit&gt; nameOrdering = Ordering.natural().onResultOf(getNameFunction);

// ordonner par couleur puis par nom
Ordering&lt;Fruit&gt; colorAndNameOrdering = colorOrdering.compound(nameOrdering);

List&lt;Fruit&gt; sortedFruitList = Ordering.natural().sortedCopy(fruits);
Set&lt;Fruit&gt; sortedFruits = ImmutableSortedSet.orderedBy(colorAndNameOrdering).addAll(fruits).build();
</code></pre>
<p>Filtrer des éléments est devenu super facile à utiliser. Il nous faut les classes Predicate et Predicates.</p>
<pre><code class="language-java">List&lt;String&gt; names = Lists.asList(&quot;Clément&quot;, &quot;Jean-Max&quot;, &quot;Caroline&quot;, &quot;Céline&quot;, &quot;Brice&quot;);
Iterable&lt;String&gt; filtered = Iterables.filter(
    names,
    Predicates.or(
        Predicates.or(Predicates.equalTo(&quot;Clément&quot;), Predicates.equalTo(&quot;Brice&quot;)),
        returnALengthPredicate(5)
    )
);
</code></pre>
<p>Il est possible de faire des transformations</p>
<pre><code class="language-java">Lists.transform(lotoNumbers, new Function&lt;String , Integer&gt; {
    public Integer apply(final String from) {
        return Integer.valueOf(from);
    }
});
</code></pre>
<p>Que peut-on faire d’autre? Par exemple avec les maps et les sets, on peut observer les différences, faire des unions, ou faire des intersections.</p>
<pre><code class="language-java">MapDifference&lt;String , Integer&gt; differenceMap = Maps.difference(mapA, mapB);
differenceMap.areEqual();
Map&lt;String , ValueDifference&lt;Integer&gt;&gt; entriesDiffering = differenceMap.entriesDiffering();
Map&lt;String , Integer&gt; entriesOnlyOnLeft = differenceMap.entriesOnlyOnLeft();
Map&lt;String , Integer&gt; entriesOnlyOnRight = differenceMap.entriesOnlyOnRight();
Map&lt;String , Integer&gt; entriesInCommon = differenceMap.entriesInCommon();
</code></pre>
<p>On peut également faire de l’indexation sur des listes de map :</p>
<pre><code class="language-java">List&lt;String&gt; badGuys = Arrays.asList(&quot;Inky&quot;, &quot;Scratchy&quot;, &quot;Blinky&quot;, &quot;Pinky&quot;, &quot;Pinky&quot;, &quot;Clyde&quot;);
Function&lt;String , Integer&gt; stringLengthFunction = ...;

Multimap&lt;String , Integer&gt; index = Multimaps.index(badGuys, stringLengthFunction); // { 4=[Inky], 5=[Pinky, Pinky, Clyde], 6=[Blinky], 7=[Scratchy] }
</code></pre>
<p>Au cas ou pour éviter de chercher voici quelques méthodes utilitaires dans Iterables, d&rsquo;ailleurs c&rsquo;est là qu&rsquo;on retrouve le fameux isEmpty. (Attention la librairie google ne vérifie pas la nullité, et leur argument est de ne pas encourager de retourner null mais plutôt des collections vide, bref ce que dit Joshua Blosh dans son fameux livre Effective Java, §Item 43)</p>
<pre><code class="language-java">Iterables.getOnlyElement(ImmutableSet.of(&quot;1&quot;)); // 0
Iterables.getOnlyElement(ImmutableSet.of(&quot;1&quot;, &quot;2&quot;)); // IllegalArgumentException

Iterables.isEmpty(ImmutableMultiset.of()); // true
Iterables.isEmpty(null); // NullPointerException
Iterable&lt;String&gt; moreFruits = Iterables.concat(ImmutableMultiset.of(&quot;apple&quot;, &quot;banana&quot;, &quot;kiwi&quot;), Lists.newArrayList(&quot;ananas&quot;, &quot;orange&quot;)); // &quot;apple&quot;, &quot;banana&quot;, &quot;kiwi&quot;, &quot;ananas&quot;, &quot;orange&quot;
String kiwi = Iterables.getLast(ImmutableMultiset.of(&quot;apple&quot;, &quot;banana&quot;, &quot;kiwi&quot;)); // &quot;kiwi&quot;

Iterable&lt;List &lt;String&gt;&gt; fruitBasket = Iterables.partition(moreFruits, 2);  // { &quot;apple&quot;, &quot;banana&quot; }, { &quot;kiwi&quot;, &quot;ananas&quot; }, { &quot;orange&quot; }
</code></pre>
<p>Pour passer d’un Iterable à un tableau :</p>
<pre><code class="language-java">Iterables.toArray(Lists.newArrayList(new DateTime(), new DateTime().plusDays(1)), DateTime.class);
</code></pre>
<p>Voilà il y a pas mal de petits trucs bien sympa, ceci dit il peut manquer des choses qui nous semblent essentielles. Mais cette bibliothèque apporte enfin des choses qui nous simplifient la vie. Les commons-collection ont bien marqués nos habitudes, mais pour s’y retrouver et utiliser cette bibliothèque à bon escient il est certain qu&rsquo;il va falloir faire un petit effort.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2010/02/12/une-fuite-memoire-beaucoup-de-reflection-et-pas-de-outofmemoryerror/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Une fuite mémoire, beaucoup de reflection et pas de OutOfMemoryError</span>
    </a>
    
    
    <a href="/2010/03/09/mockito-1-8-3/" class="navigation-next">
      <span class="navigation-tittle">Mockito 1.8.3</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
        
        
        
        this.page.identifier = 'https://blog.arkey.fr/2010/02/16/les-collections-par-google-comment-sy-retrouver/';
        this.page.title = 'Les collections par Google, comment s\x27y retrouver?';
        this.page.url = 'https://blog.arkey.fr/2010/02/16/les-collections-par-google-comment-sy-retrouver/';
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "thecoffeeworkshop" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>


        </div>
        
    










<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script><script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    
    




    



    </body>
</html>
